<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrector de Pronunciación (Versión Final)</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 2em; }
        button { font-size: 1.2em; padding: 10px 20px; cursor: pointer; }
        #feedback { margin-top: 20px; font-size: 1.2em; min-height: 50px; }
        .correct { color: green; }
        .incorrect { color: red; }
    </style>
</head>
<body>
    <h1>Ejercicio de Pronunciación</h1>
    <p>Di la siguiente frase: "I am learning English"</p>

    <button id="recordButton">Presiona para Grabar</button>

    <div id="feedback"></div>

    <script>
        // --- Referencias a los elementos de la página ---
        const recordButton = document.getElementById('recordButton');
        const feedbackDiv = document.getElementById('feedback');
        const targetPhrase = "i am learning english";

        // --- Comprobar si el navegador es compatible ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        
        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'en-US'; // Escuchar en Inglés de Estados Unidos
            recognition.interimResults = false;

            // --- Qué hacer cuando el botón es presionado ---
            recordButton.onclick = () => {
                feedbackDiv.innerHTML = "Escuchando...";
                feedbackDiv.className = '';
                recordButton.disabled = true;
                recognition.start();
            };

            // --- Qué hacer cuando se termina de detectar la voz ---
            recognition.onspeechend = () => {
                recognition.stop();
                recordButton.disabled = false;
                recordButton.innerHTML = "Presiona para Grabar";
            };
            
            // --- Qué hacer cuando hay un resultado ---
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase().trim();

                if (transcript === targetPhrase) {
                    // Si la pronunciación es CORRECTA
                    feedbackDiv.innerHTML = `<h3>¡Excelente! Tu pronunciación es perfecta.</h3>`;
                    feedbackDiv.className = 'correct';
                    speak("Excelente, tu pronunciación es perfecta.", "es-ES");
                } else {
                    // Si la pronunciación es INCORRECTA
                    feedbackDiv.innerHTML = `
                        <h3>Inténtalo de nuevo.</h3>
                        <p>Escuché: "<em>${transcript}</em>"</p>
                    `;
                    feedbackDiv.className = 'incorrect';
                    speak("La pronunciación es incorrecta. Se dice...", "es-ES", () => {
                        speak("I am learning English", "en-US");
                    });
                }
            };

            // --- Qué hacer si hay un error ---
            recognition.onerror = (event) => {
                feedbackDiv.innerHTML = 'Hubo un error o no se detectó audio. Intenta de nuevo.';
                feedbackDiv.className = 'incorrect';
                recordButton.disabled = false;
                recordButton.innerHTML = "Presiona para Grabar";
            };

        } else {
            // Si el navegador NO es compatible
            feedbackDiv.innerHTML = "Lo siento, tu navegador no es compatible con el reconocimiento de voz. Por favor, intenta con Google Chrome.";
            recordButton.disabled = true;
        }

        // --- Función para que la página HABLE ---
        function speak(text, lang, onEndCallback) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            if (onEndCallback) {
                utterance.onend = onEndCallback;
            }
            window.speechSynthesis.speak(utterance);
        }
    </script>
</body>
</html>
